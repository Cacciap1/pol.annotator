# pol.annotator
Political Annotator with LLM (OpenAI)


# Supervised Annotation Tool with ChatGPT and Codebook Support

## Overview

This tool performs supervised annotation of political text data using the OpenAI ChatGPT API, guided by a structured codebook of label definitions and few-shot examples. It supports multi-label classification of quasi-sentences (short political statements) and was developed to enable scalable, consistent dataset creation for NLP and political economics research.

## Academic Context

This tool was developed as part of a Master’s Thesis:

**Title:** *Do Elections Matter? A Quasi-Experimental Analysis of Political Supply and Public Spending at the U.S. State Level*  
**Author:** Francesco Cacciapuoti  
**University:** Università Commerciale Luigi Bocconi  
**Supervisor:** Prof. Guido Tabellini *(Note: this tool was developed independently as a support tool and not under direct supervision)*  
**Year:** 2025

## Features

- Uses the OpenAI ChatGPT API (GPT-3.5 or GPT-4)
- Codebook-based prompting with label definitions and few-shot examples
- Multi-label support (e.g., `tax_cuts,health_care`)
- Input: `.xlsx` dataset of US political quasi-sentences
- Output: `.xlsx` file with predicted label(s)
- No command-line interface required — all parameters are set in the script

## How to Use

1. Open the script `pol.annotator.py` in any Python IDE or editor.
2. Set the following variables manually inside the script:

API_KEY = "your_openai_api_key"  
INPUT_FILE = "Dataset_USman_1988-2022.xlsx"  
FEWSHOT_FILE = "few_longshots.txt"  
OUTPUT_FILE = "Annotated_Dataset_Complete.xlsx"

3. Run the script. The tool will annotate each row using the ChatGPT API and save the labeled dataset to the specified output path.

## Input Format

The script expects the input dataset (`Dataset_USman_1988-2022.xlsx`) to be an Excel file with a single sheet containing at least one column named `text`, where each row is a quasi-sentence (short political statement) to annotate.

Example:

| text                                                              |
|-------------------------------------------------------------------|
| We want to ensure flexibility for both Medicare and Medicaid.     |
| That’s why we propose tax cuts for working families.              |

## Codebook Format

The codebook file (`few_longshots.txt`) should be a plain text file that defines each label with:

- A label name (e.g., `tax_cuts`)
- A definition of the label
- A list of few-shot examples

Each example is formatted like this:

Text: example sentence here  
Label: tax_cuts

The structure of the file should follow this logic:

-label_name: Definition text...

Text: ...
Label: ...

Text: ...
Label: ...

This format allows the script to dynamically build a prompt to guide the ChatGPT model during annotation.

## Output Example

| text                                                          | label                        |
|---------------------------------------------------------------|------------------------------|
| We want to ensure flexibility for both Medicare and Medicaid. | health_care                  |
| That’s why we propose tax cuts for working families.          | tax_cuts                     |
| We protect pensions and cut taxes at the same time.           | pension_spend,tax_cuts       |

## Requirements

Install required packages with:

pip install -r requirements.txt

Contents of `requirements.txt`:

openai  
pandas  
openpyxl  
tqdm

## File Descriptions

| File                                 | Description                                                                                      |
|--------------------------------------|--------------------------------------------------------------------------------------------------|
| `pol.annotator.py`                   | Main Python script that performs the supervised annotation using the OpenAI ChatGPT API.         |
| `few_longshots.txt`                  | Codebook file containing label definitions and few-shot examples used to guide the model's output.|
| `Dataset_USman_1988-2022.xlsx`       | Input dataset with quasi-sentences from US political manifestos (1988–2022).                     |
| `Annotated_Dataset_Complete.xlsx`    | Final output dataset generated by the script, containing the predicted labels.                   |
| `evaluation_sample.xlsx`             | Optional: manually annotated sample used for qualitative or quantitative comparison.             |
| `requirements.txt`                   | Python dependencies required to run the script.                                                  |
| `README.md`                          | This documentation file, explaining usage and structure of the project.                          |
| `LICENSE`                            | MIT license file for open-source distribution and reuse.                                         |

## License

This project is released under the MIT License. See the `LICENSE` file for details.

## Credits

Developed by Francesco Cacciapuoti  
Master’s Degree in Economic and Social Sciences  
Università Commerciale Luigi Bocconi
